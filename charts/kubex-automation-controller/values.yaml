serviceAccount:
  # Additional labels to apply to all kubex service accounts
  labels: {}
    # Example:
    # app: kubex-automation
    # environment: production
  
  # Additional annotations to apply to all kubex service accounts
  annotations: {}
    # Example:
    # iam.gke.io/gcp-service-account: my-gcp-sa@project.iam.gserviceaccount.com

certmanager:
  enabled: false # Set to true to use cert-manager instead of self-signed certificates
  duration: 720h # Certificate validity duration (e.g., 30 days = 720h)
  renewBefore: 240h # Time before expiration to trigger renewal (e.g., 10 days = 240h).
  rotationPolicy: Always

# Self-signed certificate configuration (used when certmanager.enabled=false)
selfSignedCert:
  enabled: true # Generate self-signed certificate during installation
  validity: 3650 # Certificate validity in days (default: 10 years)

policy:
  policies: {} # Additional policies can be defined here, remove {} when adding new policies

webhook:
  metadataName: kubex-resource-optimization-webhook # Name of the webhook configuration.

deployment:
  webhookImage: densify/container-automation:1.4 # Container image for the Kubex automation webhook server.
  gatewayImage: densify/automation-gateway:1.1 # Container image for the Kubex automation gateway.
  controllerImage: densify/automation-director:1.2 # Container image for the Kubex automation controller.
  waitForValkeyImage: busybox:latest

  replicas: # Number of pod replicas to run ([set >1 for high availability).
    webhookServer: 1
    controller: 1
  webhookResources: # Resource Specs for the webhook server pod
    requests:
      memory: "64Mi" # Reduced from 128Mi for better scheduling
      cpu: "100m"
    limits:
      memory: "512Mi" # Maximum memory the pod can use before being throttled or killed
  gatewayResources: # CPU and memory resource requests and limits for the pod
    requests:
      memory: "64Mi" # Minimum guaranteed memory allocated to the pod
      cpu: "100m" # Minimum guaranteed CPU
    limits:
      memory: "512Mi" # Maximum memory the pod can use before being throttled or killed
  controllerResources: # Resource Specs for the controller pod
    requests:
      memory: "128Mi" # Minimum guaranteed memory allocated to the pod
      cpu: "250m" # Minimum guaranteed CPU
    limits:
      memory: "512Mi" # Maximum memory the pod can use before being throttled or killed
  controllerEnv: # Environment variables for the controller pod
    podScanInitialInterval: "2m"  # Initial delay before first pod scan after startup
    podScanInterval: "1h"  # Default optimized for in-place resizing (Kubernetes 1.33+). See Pod-Scan-Configuration.md for pod eviction mode settings.
    podScanTimeout: "30m"   # Default optimized for in-place resizing. Adjust based on cluster size - see Pod-Scan-Configuration.md
    podEvictionCooldownPeriod: "1m"  # Cooldown between pod evictions (only used when in-place resizing unavailable on Kubernetes < 1.33 or policy inPlaceResize.enabled: false)
  
    recommendationsFetchInitialDelay: "1m"
    recommendationsFetchInterval: "1h"  
    recommendationsResyncTimeout: "45m"
    recommendationDataFormat: "protobuf"
    
    debug: false # Enable debug mode (true/false).
    suppressInPlaceResizing: "false"
    shufflePods: "false"
    
    # Node resource headroom configuration
    nodeCpuHeadroom: "10%"        # CPU headroom to reserve on each node
    nodeMemoryHeadroom: "10%"    # Memory headroom to reserve on each node

    evictionThrottlingWindow: "6h"
    evictionThrottlingMax: "1000"

    apiRequestTimeout: "30s"
    loggerParseTimestamp: "true"
        
  # Additional environment variables for containers
  # Use this to add NEW custom variables that don't exist in controllerEnv defaults
  extraEnv:
    # Environment variables for controller container
    controller: []
      # - name: CUSTOM_FEATURE_FLAG
      #   value: "enabled"
      # - name: MY_CUSTOM_VAR
      #   value: "custom-value"
    
    # Environment variables for controller gateway initContainer
    controllerGateway: []
      # - name: GATEWAY_SPECIFIC_VAR
      #   value: "gateway-value"
    
    # Environment variables for webhook container
    webhook: []
      # - name: WEBHOOK_FEATURE_FLAG
      #   value: "enabled"
      # - name: MY_WEBHOOK_VAR
      #   value: "webhook-value"
    
    # Environment variables for webhook gateway initContainer
    webhookGateway: []
      # - name: WEBHOOK_GATEWAY_VAR
      #   value: "webhook-gateway-value"
  
  # Node scheduling configuration for controller deployment
  controller:
    nodeSelector: {} # Node labels for pod assignment (e.g., node-pool: system)
    affinity: {} # Affinity rules for advanced node selection
    tolerations:
      # Tolerate arch taints (works on both amd64 and arm64 clusters)
      - key: "kubernetes.io/arch"
        operator: "Exists"
        effect: "NoSchedule"
    topologySpreadConstraints: [] # Topology spread constraints for pod distribution
  
  # Node scheduling configuration for webhook deployment  
  webhook:
    nodeSelector: {} # Node labels for pod assignment (e.g., node-pool: system)
    affinity: {} # Affinity rules for advanced node selection
    tolerations:
      # Tolerate arch taints (works on both amd64 and arm64 clusters)
      - key: "kubernetes.io/arch"
        operator: "Exists"
        effect: "NoSchedule"
    topologySpreadConstraints: [] # Topology spread constraints for pod distribution

valkey:
  # Valkey credentials
  credentials:
    # Username for Valkey authentication (defaults to "kubexAutomation" if not set)
    user: "kubexAutomation"
    # Password for Valkey authentication.
    # This is a mandatory field and must be set in kubex-automation-values.yaml.
    # password: ""

  image:
    registry: docker.io
    repository: valkey/valkey
    tag: "9.0"
    pullPolicy: Always

  # No TLS requested

  # Add password to valkey.conf via a Secret file
  extraSecretValkeyConfigs: kubex-valkey-secret

  podSecurityContext:
    seccompProfile:
      type: RuntimeDefault

  securityContext:
    seccompProfile:
      type: RuntimeDefault

  # Storage for single-instance (non-HA)
  storage:
    requestedSize: "10Gi"
    className: ""  # Use cluster default storage class (users override in kubex-automation-values.yaml)
    keepPvc: false

  service:
    type: ClusterIP
    serverPort: 6379

  # Resource sizing (tune for your cluster/workload)
  resources:
    requests:
      cpu: "250m"
      memory: "256Mi"
    limits:
      memory: "512Mi"

  # Use a Deployment in non-HA mode (default)
  useDeploymentWhenNonHA: true

  # Node scheduling configuration
  tolerations:
    # Tolerate arch taints (works on both amd64 and arm64 clusters)
    - key: "kubernetes.io/arch"
      operator: "Exists"
      effect: "NoSchedule"

    # Metrics exporter enabled; no Prometheus Operator
  metrics:
    enabled: true
    exporter:
      securityContext:
        seccompProfile:
          type: RuntimeDefault
      image:
        registry: docker.io
        repository: oliver006/redis_exporter
        tag: v1.76.0
        pullPolicy: Always
      extraExporterEnvSecrets:
        - kubex-valkey-client-auth
      resources:
        requests:
          cpu: "50m"
          memory: "64Mi"
        limits:
          memory: "128Mi"
    service:
      enabled: true
      type: ClusterIP
      servicePort: 9121
      containerPort: 9121
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "9121"
        prometheus.io/path: "/metrics"
    serviceMonitor:
      enabled: false
