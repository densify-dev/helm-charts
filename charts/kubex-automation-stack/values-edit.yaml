#################################################################
# Global Configuration
# Shared settings used across all subcharts
#################################################################
global:
  cluster:
    name: '' # MANDATORY: Unique cluster name (must be unique customer-wide)
  createSecret: true # Set to false if providing your own secret
  kubex:
    url:
      host: '' # MANDATORY: Kubex instance (e.g., <instance>.kubex.ai or <instance>.densify.com)
  credentials:
    username: '' # MANDATORY: Kubex username (used by both data collector and automation controller)
    epassword: '' # MANDATORY: Kubex encrypted password (used by both data collector and automation controller)

#################################################################
# Stack deployment target
# IMPORTANT: Change stack.flavor below, then uncomment the corresponding
# platform-specific section in the Kubex Data Collector configuration
#################################################################
stack:
  flavor: standard # REQUIRED: Change to: standard | gkeAutopilot | openshift
  
  # GKE Autopilot specific (only when flavor: gkeAutopilot)
  runsInGKEAutopilot: true # Set to false if collecting from GMP remotely
  gcpServiceAccountKeyName: '' # (Remote GMP collection only) Secret key filename
  gcpServiceAccountKeyContents: '' # (Remote GMP collection only) Inline contents

#################################################################
# Kubex Data Collector
# Collects and sends container metrics to Kubex for analysis
#
# PLATFORM-SPECIFIC CONFIGURATION:
# - For OpenShift: Uncomment the "OPENSHIFT CONFIGURATION" section below
# - For GKE Autopilot: Uncomment the "GKE AUTOPILOT CONFIGURATION" section below
# - For standard K8s: Leave platform sections commented
#################################################################
kubex-data-collector:
#  enabled: true # Set to false to disable Kubex Data Collector
  # Note: Credentials are inherited from global.credentials
  # Override here only if you need different credentials for the data collector
  credentials:
    username: '' # Override global.credentials.username if needed
    epassword: '' # Override global.credentials.epassword if needed

  # ================================================================
  # OPENSHIFT CONFIGURATION (uncomment when stack.flavor: openshift)
  # ================================================================
  # image: densify/container-optimization-data-forwarder:ubi10-4.3.2
  # assignedUIDs: true
  # job:
  #   checkPrometheusReady: false
  # rbac:
  #   create: true
  # serviceAccount:
  #   create: true
  #   name: kubex-collection
  # config:
  #   prometheus:
  #     url:
  #       scheme: https
  #       host: prometheus-k8s.openshift-monitoring.svc
  #       port: 9091
  #     ca_cert: /var/run/secrets/kubernetes.io/serviceaccount/service-ca.crt
  
  # ================================================================
  # GKE AUTOPILOT CONFIGURATION (uncomment when stack.flavor: gkeAutopilot)
  # ================================================================
  # job:
  #   checkPrometheusReady: false
  # serviceAccount:
  #   isGKE: true
  #   create: true
  #   name: kubex-forwarder
  # config:
  #   prometheus:
  #     url:
  #       scheme: https
  #       host: monitoring.googleapis.com
  #       port: 443
  #   clusters:
  #     - name: '' # Will auto-populate from global.cluster.name
  #       identifiers:
  #         cluster: '<gke-cluster-name>' # REQUIRED: Your GKE cluster name
  #         collected_by: kubex-stack

  # Optional: Job cleanup configuration (applies to all flavors)
  # Each value should be a non-negative integer (0 is allowed)
  # cronJob:
    # successfulJobsHistoryLimit: <value> # Number of successful jobs to retain
    # failedJobsHistoryLimit: <value> # Number of failed jobs to retain
    # ttlSecondsAfterFinished: <value> # Time to live after job completion (applies to both CronJob and Job)
    # backoffLimit: <value> # Number of retries for failed jobs (default: 4)

#################################################################
# Prometheus
# PLATFORM-SPECIFIC: Uncomment this section when using OpenShift or GKE Autopilot
# (these platforms use external Prometheus, so we disable the built-in one)
#################################################################
# prometheus:
  # enabled: false # REQUIRED for gkeAutopilot and openshift flavors
  # server:
    # persistentVolume:
      # storageClass: <changeme-storage-class> # Specify storage class if not using default

#################################################################
# Kube State Metrics
# PLATFORM-SPECIFIC: Uncomment this section when using GKE Autopilot
#################################################################
# kube-state-metrics:
  # enabled: true # REQUIRED when stack.flavor: gkeAutopilot

#################################################################
# Kubex Automation Controller
# Automates resource optimization based on Kubex recommendations
# Note: Uses separate credentials from Kubex Data Collector
#
# IMPORTANT: Detailed configuration for automation policies,
# valkey settings, and cluster scope is located in
# 'kubex-automation-values.yaml'. Review and update that file
# if enabling automation.
#################################################################
kubex-automation-controller:
  enabled: false # Set to true to enable automated optimization
  # Note: Credentials are inherited from global.credentials
  # Override here only if you need different credentials for the automation controller
  credentials:
    username: '' # Override global.credentials.username if needed
    epassword: '' # Override global.credentials.epassword if needed
  valkey:
    credentials:
      password: '' # MANDATORY (if enabled): Valkey authentication password
    storage:
      className: '' # Optional: Specify storage class if not using default

  # ================================================================
  # AUTOMATION POLICY
  # ================================================================
  policy:
    automationEnabled: true # Global Switch to enable/disable automation for the cluster

  # ================================================================
  # SCOPE CONFIGURATION
  # → Define which pods are eligible for automation using namespace and label filters
  # → ⚠️ IMPORTANT: When policy.automationEnabled is set to true, you MUST define at least one scope
  # ================================================================
  scope: []
    # - name: base-optimization-scope # Unique scope name
    #   policy: base-optimization     # Policy name (optional - uses defaultPolicy in kubex-automation-values.yaml)
    #   namespaces:           # Mandatory - defines which namespaces to include/exclude
    #     operator: NotIn     # Options: In | NotIn
    #     values:
    #       - kubex           # Kubex namespace (exclude automation components)
    #   podLabels:            # Optional - defines which pods to include/exclude based on labels
    #     - key: app        # Replace with actual label key (e.g., "app", "env", "tier")
    #       operator: In              # Options: In | NotIn
    #       values:
    #         - myapp     # Replace with actual label values